/* Mobile overrides that WIN no matter what */
@media (max-width: 768px) {
  html body {
    display: block !important;
    padding-top: 60px !important; /* JS will set exact height */
    background: #F1F4F7;
  }

  /* Stack deck -> chat on mobile */
  .layout {
    display: grid !important;
    grid-template-columns: 1fr !important;
    grid-template-rows: auto auto !important;
    grid-template-areas:
      "deck"
      "chat" !important;
    min-height: auto !important;
  }

  /* Deck panel (top) */
  .content-panel {
    grid-area: deck !important;
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    position: static !important;
    float: none !important;
    flex: none !important;

    /* default when not dragging */
    min-height: 55svh !important;
    max-height: 55svh !important;

    border-right: none !important;
    border-bottom: 1px solid rgba(255,255,255,0.1) !important;
    padding: 16px 16px 10px 16px !important; /* a bit tighter by default */
    justify-content: flex-start !important;

    display: flex !important;
    flex-direction: column !important;

    /* IMPORTANT: never clip fanned cards */
    overflow: visible !important;
  }

  /* Keep dots right under the cards */
.carousel-nav {
  position: relative;
  z-index: 5;            /* above deck bg but below chat panel */
  margin-top: 20px;      /* space below cards */
  margin-bottom: 10px;   /* space before chat starts */
}

  /* Selection container + rows must not clip cards */
  .card-selection-container { overflow: visible !important; }
  .card-row { overflow: visible !important; }

  /* Chat panel (bottom) */
  .chat-panel {
    grid-area: chat !important;
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    position: relative !important;
    float: none !important;
    flex: none !important;
    background-color: #F1F4F7; 

    /* default when not dragging */
    height: 45svh !important;
    min-height: 0 !important;
    max-height: none !important;

    border-right: none !important;
    border-top: 1px solid rgba(255,255,255,0.1) !important;
    padding: 5px 10px !important;
    justify-content: flex-start !important;

    display: flex !important;
    flex-direction: column !important;

    overflow: hidden !important; /* content scrolls inside .chat-messages */
  }

  /* The scroll area */
  .chat-messages {
    flex: 1 1 auto !important;
    min-height: 0 !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
    max-height: none !important;  /* let it breathe; sticky CTA will stay visible */
    margin-top: 0 !important;
    padding-top: 5px !important;
    background-color: #F1F4F7;
  }

  .shuffle-container { padding-top: 5px !important; }

  /* Card selection sizing */
  .card { width: 80px !important; height: 120px !important; }
  .card-row { height: 200px; } /* no !important so JS can adjust */

  /* Popup sizing */
  .popup-container { width: 90% !important; height: 500px !important; }

  /* Carousel sizing */
  .carousel-card { width: 150px !important; height: 225px !important; }
  .carousel-card.prev { transform: translateX(-120px) scale(0.8) rotateY(10deg) !important; }
  .carousel-card.next { transform: translateX(120px) scale(0.8) rotateY(-10deg) !important; }
}

/* Fallback + modern viewport units (no cap on chat-messages here) */
@media (max-width: 768px) {
  .content-panel { min-height: 55vh; max-height: 55vh; }
  .chat-panel    { min-height: 45vh; max-height: 45vh; }

  @supports (height: 100svh) {
    .chat-panel { min-height: 45svh; max-height: 45svh; }
  }
}

/* Mobile chat-card thumbs shown under messages */
@media (max-width: 768px) {
  .chat-card-thumb {
    margin: 8px 0 16px 52px;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
  }
  .chat-card-thumb .thumb-label {
    font-size: 12px;
    color: rgba(255,255,255,0.7);
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: .04em;
  }
  .chat-card-thumb .thumb-img {
    width: 100px;
    height: 150px;
    object-fit: cover;
    border-radius: 8px;
    border: 1px solid rgba(255,255,255,0.08);
    box-shadow: 0 6px 18px rgba(0,0,0,.5);
  }
}

/* Hide thumbs on desktop */
@media (min-width: 769px) {
  .chat-card-thumb { display: none; }
}

/* ---------- Bottom-sheet chat (mobile only, only used in 'carousel' phase) ---------- */
@media (max-width: 768px) {
  .chat-panel.sheet {
    position: fixed !important;
    left: 0; right: 0; bottom: 0;
    height: 45svh !important;     /* initial overlay height */
    z-index: 400;
    border-top-left-radius: 16px;
    border-top-right-radius: 16px;
    box-shadow: 0 -12px 40px rgba(0,0,0,.6);
    overflow: hidden;              /* content scrolls inside */
  }

  /* Drag handle INSIDE the chat (so overflow:hidden doesn't clip it) */
  #chatDragHandle {
    position: absolute;
    top: 6px;                      /* visible & tappable */
    left: 0; right: 0;
    height: 28px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    pointer-events: auto;
    touch-action: none;            /* smooth dragging */
    z-index: 450;
    color: grey;
  }

  #chatDragHandle .chevron {
    width: 10px; height: 10px;
    border-left: 2px solid rgba(255,255,255,.9);
    border-top: 2px solid rgba(255,255,255,.9);
    transform: rotate(45deg);
    margin-bottom: 4px;
  }
  #chatDragHandle .grab-pill {
    width: 44px; height: 5px;
    border-radius: 999px;
    background: rgba(255,255,255,.35);
  }
}

/* --- Shuffle phase tweaks (mobile only) --- */
@media (max-width: 768px) {
  /* Smaller stack + headroom so it never hides under the top bar */
  body[data-phase="shuffle"] .shuffle-container {
    padding-top: 10px !important;
  }
  body[data-phase="shuffle"] .card-stack,
  body[data-phase="shuffle"] .stack-card {
    width: 136px !important;
    height: 194px !important;
  }

  /* Slightly more room for chat so the CTA isn't clipped */
  body[data-phase="shuffle"] .content-panel {
    min-height: 48svh !important;
    max-height: 48svh !important;
  }
  body[data-phase="shuffle"] .chat-panel {
    height: 52svh !important;
  }

  /* Tighten the chat header to reclaim a few pixels */
  .chat-header {
    padding: 8px 0 !important;
    margin-bottom: 8px !important;
  }
  .erika-avatar { width: 42px !important; height: 42px !important; }
  .erika-info h2 { font-size: 16px !important; }
  .erika-info p  { font-size: 11px !important; }
}

/* Extra-small screens: shrink a touch more */
@media (max-width: 768px) and (max-height: 640px) {
  body[data-phase="shuffle"] .card-stack,
  body[data-phase="shuffle"] .stack-card {
    width: 122px !important;
    height: 176px !important;
  }
}

/* === Sticky CTA just under chat header on mobile === */
.cta-wrap {
  display:flex;
  align-items:center;
  gap:12px;
  margin:8px 0 12px 52px;   /* aligns with avatar indentation */
  opacity:0;
  transform:translateY(6px);
  transition:opacity .25s ease, transform .25s ease;
}
.cta-wrap.visible { opacity:1; transform:translateY(0); }

@media (max-width: 768px) {
  .cta-wrap {
    position: sticky;
    top: 4px;               /* sits right below the chat header */
    z-index: 2;
    background: #F1F4F7;
    padding-top: 4px;
    padding-bottom: 6px;
  }

  .upgrade-panel .continue-button.active {
  background: white !important;
  color: black !important;
  border: none !important;
}

#upgradeBtn {
  background: white !important;
  color: black !important;
  border: none !important;
}

}

@media (max-width: 768px) {
  .card-carousel-container {
    padding-bottom: 30px; /* ensures dots are above chat boundary */
  }
}